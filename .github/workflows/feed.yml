name: KuCoin Solayer feed

on:
  schedule:            # elke 15 min (UTC)
    - cron: "*/15 * * * *"
  workflow_dispatch:

jobs:
  push-feed:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Repo klonen
      - uses: actions/checkout@v4

      # 2️⃣ Python 3.11 installeren (compatibel met pandas 2.x)
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3️⃣ Dependencies installeren (robuust)
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -s requirements.txt ]; then          #  -s  ⇒ bestand bestaat én >0 bytes
            echo "using requirements.txt"
            pip install --no-cache-dir -r requirements.txt
          else
            echo "no requirements.txt – installing packages directly"
            pip install --no-cache-dir pandas ta requests
          fi

      # 4️⃣ Feed genereren & pushen
      - name: Update Gist feed
        env:
          GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
          GIST_ID: ${{ secrets.GIST_ID }}
        run: python kucoin_solayer_feed.py
